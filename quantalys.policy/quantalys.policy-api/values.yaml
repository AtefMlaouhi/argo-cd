image:
  registry: registry-git.harvest.fr/quantalys/cicd/argocd-dotnet
  repository: quantalys.policy.api
  pullPolicy: IfNotPresent

imagePullSecrets:
  - name: gitlab
nameOverride: ""
fullnameOverride: "quantalys-policy-api"

podAnnotations:
  env: unspecified
  version: unspecified
  proxy.istio.io/config: '{ "holdApplicationUntilProxyStarts": true }' # Ensure proxy is started before starting the app container

appsettingsJson:
  nothing: yup

service:
  type: ClusterIP
  port: 80

probes: {}

serviceAccount:
  create: true
  annotations: {}
  name: ""

resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 100m
    memory: 768Mi

replicaCount: 2

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 4
  targetCPUUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

# Prevent multiple pods on the same host
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 1
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: "app"
                operator: In
                values:
                  - "{{ .Release.Name }}"
              - key: "app.kubernetes.io/name"
                operator: In
                values:
                  - '{{ include "quantalys.policy.name" . }}'
              - key: "app.kubernetes.io/instance"
                operator: In
                values:
                  - "{{ .Release.Name }}"
          topologyKey: "kubernetes.io/hostname"
