kind: ConfigMap
apiVersion: v1
metadata:
  name: {{ include "quantalys.policy.act.frontend.fullname" . }}-config
data:
  nginx.conf: |
    {{- tpl .Values.nginx_config . | nindent 4 }}

  config.js: |
    var PolicyActConfig = {
        baseUrl: 'https://quantalys-policy-act-bff-axa-api-k8s.dev.harvest.fr', // baseUrl utilisée pour charger les assets dans les templates
        keycloakConfig: {
            url: 'https://keycloak-rci.harvest-r7.fr/auth',
            logoutRedirectUrl: 'https://quantalys-policy-act-axa-k8s.dev.harvest.fr', // peut être différente de l'application elle-même
            realm: 'REALM',
            clientId: 'front-app',
            loginOptions: {
                idpHint: '',
            },
        },
        urls: {
            remotes: {},
            configs: {},
            fonts: {},
            apis: {
                myapi: 'https://example-k8s.dev.harvest.fr/',
            },
        },
        version: '1.0.0'
      };

    // pour Angular
    if (typeof window !== 'undefined') {
        window.PolicyActConfig = PolicyActConfig;

        // chargement des configs des microfrontends consommés
        var configs = PolicyActConfig.urls.configs;
        Object.keys(configs).forEach(function (key) {
            var script = document.createElement('script');
            script.src = configs[key];
            document.head.appendChild(script);
        });

        var fonts = PolicyActConfig.urls.fonts;
        Object.keys(fonts).forEach(function (key) {
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = fonts[key];
            link.media = 'all';
            document.head.appendChild(link);
        });
     }

    // pour Webpack
    if (typeof exports !== 'undefined') {
        exports.PolicyActConfig = PolicyActConfig;
    }
